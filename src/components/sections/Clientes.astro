---
// Clientes.astro - A section to showcase Neuon's clients

const logos = [
  { id: 1, name: "Client 1", logo: "/images/clientes/cliente-1.svg" },
  { id: 2, name: "Client 2", logo: "/images/clientes/cliente-2.svg" },
  { id: 3, name: "Client 3", logo: "/images/clientes/cliente-3.svg" },
  { id: 4, name: "Client 1", logo: "/images/clientes/cliente-1.svg" },
  { id: 5, name: "Client 2", logo: "/images/clientes/cliente-2.svg" },
  { id: 6, name: "Client 3", logo: "/images/clientes/cliente-3.svg" },
];
---

<section
  id="Parceiros"
  class="w-full bg-gray-100 overflow-hidden scrolling-section">
  <div class="container w-full bg-gray-100 pt-24 mx-auto">
    <div class="flex flex-col items-center mb-12">
      <span class="text-laranja text-3xl mb-2">‚ù§</span>
      <h3 class="text-3xl font-semibold text-azul-escuro font-figtree">
        NOSSOS PARCEIROS
      </h3>
    </div>
  </div>

  <div class="logo-scroller pt-8 pb-24">
    <div class="logo-track" id="logoTrack">
      {
        logos.concat(logos).map((client, idx) => (
          <div class="logo-item" key={idx}>
            <img
              src={client.logo}
              alt={`${client.name} logo`}
              class="logo-image"
              draggable="false"
            />
          </div>
        ))
      }
    </div>
  </div>

  <style>
    .logo-scroller {
      width: 100vw;
      overflow: hidden;
      position: relative;
      background: #f9fafb;
    }
    .logo-track {
      display: flex;
      flex-direction: row;
      align-items: center;
      width: max-content;
      will-change: transform;
      gap: 2rem;
    }
    .logo-item {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 120px;
      height: 40px;
    }
    .logo-image {
      height: 38px;
      width: auto;
      object-fit: contain;
      user-select: none;
      pointer-events: none;
    }
    @media (max-width: 768px) {
      .logo-item {
        min-width: 100px;
      }
      .logo-track {
        gap: 1rem;
      }
    }
    @media (max-width: 480px) {
      .logo-item {
        min-width: 80px;
      }
      .logo-track {
        gap: 0.75rem;
      }
    }
  </style>

  <script>
    import { animate } from "motion";

    document.addEventListener("DOMContentLoaded", () => {
      const track = document.getElementById("logoTrack");
      if (!track) return;

      // Wait for all images to load to get correct width
      const imgs = Array.from(track.querySelectorAll("img"));
      let loaded = 0;
      imgs.forEach((img) => {
        if (img.complete) loaded++;
        else
          img.addEventListener("load", () => {
            loaded++;
            if (loaded === imgs.length) startMotion();
          });
      });
      if (loaded === imgs.length) startMotion();

      function startMotion() {
        // The track is duplicated, so scroll by half its width
        const trackWidth = track.scrollWidth / 2;
        track.style.transform = "translateX(0)";
        animate(
          track,
          { transform: [`translateX(0px)`, `translateX(-${trackWidth}px)`] },
          {
            duration: 18,
            easing: "linear",
            repeat: Infinity,
          }
        );
      }
    });
  </script>
</section>

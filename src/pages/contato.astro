---
import "../styles/global.css";
import Layout from "../layouts/Layout.astro";

export const prerender = false;

import ContactForm from "../components/ContactForm.tsx";

// --- Page Rendering Logic ---
interface Feedback {
  message: string;
  type: "success" | "error";
}

// Feedback handling remains the same - reads URL parameters
let serverFeedback: Feedback | null = null;
const urlParams = Astro.url.searchParams;
console.log("URL Params:", urlParams);

if (urlParams.get("success") === "true") {
  serverFeedback = {
    message: "Mensagem enviada com sucesso!",
    type: "success",
  };
} else if (urlParams.get("error")) {
  const errorCode = urlParams.get("error");
  let message = "Ocorreu um erro ao enviar a mensagem.";
  if (errorCode === "missing_fields")
    message = "Por favor, preencha todos os campos obrigatórios.";
  if (errorCode === "send_failed")
    message = "Falha no serviço de envio. Tente novamente mais tarde.";
  if (errorCode === "invalid_data") message = "Dados inválidos fornecidos.";
  if (errorCode === "invalid_request")
    message = "Erro ao processar a requisição do formulário."; // Added for form parsing error

  serverFeedback = { message: message, type: "error" };
}
---

<Layout title="teste form">
  <section class="container mx-auto py-24">
    {(<ContactForm client:load serverFeedback={serverFeedback} />)}
  </section>
</Layout>
